## 새싹 찾기 화면

- 새싹 찾기를 시작한 순간부터, 사용자(본인)가 찾기 중단을 하거나 다른 사용자와 매칭되기 전까지 사용자(본인)의 상태는 매칭 대기중 상태입니다. 

- 취미 함께 하기를 요청할 수 있는 [주변 새싹] 목록이 있고, 취미 함께 하기를 수락할 수 있는 [받은 요청] 목록이 있습니다. 

  - [주변 새싹] 은 사용자(본인)가 다른 사용자에게 취미 함께 하기를 요청할 수 있는 목록입니다. 
  - [받은 요청] 은 사용자(본인)에게 취미 함께 하기를 요청한 다른 사용자들의 목록입니다. 

- 사용자(본인)가 새싹 찾기를 진행`(POST, /queue/onqueue)` 했을 때 다른 사용자의 유무에 따라 화면이 다르게 표현됩니다. 

  - 빈 화면(1_3_near_user_empty & 1_4_accept_empty): 취미 함께 하기를 할 수 있는 다른 사용자가 없는 경우
  - 주변 새싹 화면 & 받은 요청 화면(1_3_near_user & 1_4_accept): 취미 함께 하기를 할 수 있는 다른 사용자가 있는 경우

- [주변 새싹] 에는 다른 사용자가 존재 하지만, [받은 요청] 에는 다른 사용자가 없을 수도 있습니다.

- [요청하기] 를 클릭할 경우 

  - 상대방의 받은 요청 목록에 사용자(본인)가 추가됩니다. 
  - 상대방이 수락하기를 클릭할 경우 매칭이 되어 취미를 함께할 수 있습니다. 

- [수락하기] 를 클릭할 경우 

  - 상대방이 이미 요청한 상태이기 때문에, 바로 매칭되어 취미를 함께할 수 있습니다. 

  

- **사용자(본인) 상태 확인**

- `(GET, /queue/myQueueState)`

- [x] 다른 사용자의 새싹 찾기 플로우에 따라 사용자(본인)의 상태가 달라질 수 있습니다. 

- ex. 다른 사용자가 수락하기를 클릭한 경우, 사용자(본인)의 상태는 매칭 대기중 상태에서 매칭된 상태로 변경됩니다.

- [ ] 따라서 **5초마다 서버 호출을 통해 사용자(본인)의 상태 확인**하고, 확인된 상태에 따라 다양한 로직을 진행합니다. 

- [x] **응답 코드**

  - [x] 성공(200)
    - [x] 만약 응답이 성공(200)하고 응답값 중 matched 가 1이라면, 사용자(본인) 현재 상태를 매칭된 상태로 변경합니다. 
    - [x] “000님과 매칭되셨습니다. 잠시 후 채팅방으로 이동합니다” 토스트 메시지를 1초 간 띄운 뒤, 채팅 화면(1_5_chatting)으로 이동합니다. 
  - [x] 201: 취미를 함께 하기 위해 새싹 친구를 찾는 시간이 오래 되어 찾기중단으로 처리된 경우입니다.
    - [x] “오랜 시간 동안 매칭 되지 않아 새싹 친구 찾기를 그만둡니다”는 토스트 메시지를 1초간 띄웁니다.
    - [x] 사용자(본인)의 현재 상태를 일반 상태로 변경한 뒤, 홈 화면으로 화면을 전환합니다.

  

- **새싹 찾기 목록 갱신(새로고침)** 

  ```
  (POST, /queue/onqueue)
  ```

- 새싹 찾기 목록을 요청하는 API 입니다. 

  - 새싹 찾기 목록은 다른 사용자의 플로우에 따라 시시각각 변할 수 있습니다. 

- 새로운 데이터를 사용자에게 제공해주기 위해서는, 새싹 찾기 화면에 진입했을 때 뿐만 아니라 지속적인 호출이 필요합니다. 

- **호출 시점**

  - [x] 새싹 찾기 화면 진입 시
  - [x] 주변 새싹 / 받은 요청 탭을 전환할 때 
  - [ ] 빈 화면의 [새로 고침] 버튼 클릭 시 
  - [ ] 다른 사용자 목록이 있을 경우
    - [ ] [당겨서 새로고침] 시 
    - [ ] [카드 상세 화면을 닫을 경우]
  - [ ] (옵션) 앱을 백그라운드에서 포그라운드로 전환했을 때 앱의 현재 화면이 새싹 찾기 화면일 경우 
  - [ ] **(옵션) 단, 과도한 호출이 발생할 수 있기 때문에 API 호출이 일어난 지 5초가 지나지 않았다면, 호출 시점에서도 API 호출을 하지 않습니다.** 

- **Point**

  - 왜 이렇게 자주 호출을 해야 할까요?
  - (참고) 다른 사용자의 새싹 찾기 플로우에 따라 주변 새싹에 있을 수도 있고 받은 요청에 있을 수도 있고 목록에서 사라질 수도 있습니다.
    - ex. 다른 사용자가 찾기 중단을 한 경우에는 새싹 찾기 목록에서 사라질 수 있습니다. 
    - ex. 다른 사용자가 사용자(본인)에게 요청하기를 한 경우, 주변 새싹 목록에서 받은 요청 목록으로 옮겨집니다.

- **Point**

  -  새싹 찾기 화면에서는 최신 정보를 제공해주기 위한 새로 고침 기능이 필요하고 사용자(본인)이 명시적으로 새로 고침 버튼을 누르지 않더라도 갱신이 가능한 시점에서는 갱신을 해주어야 합니다. 
  -  단, 잦은 새로 고침으로 인해 서버에 과도한 호출이 일어날 수 있어 유의해야 합니다. 어떻게 호출을 줄일 수 있을까요? 

  

**찾기 중단 버튼**

```
(DELETE, /queue)
```

- 사용자가 새싹 찾기를 그만둘 수 있는 버튼입니다. 

- 사용자의 상태는 매칭 대기중 상태에서 일반 상태로 변경됩니다. 

- 찾기 중단 이후, 홈 화면(1_1_main)으로 전환됩니다. 

  - 홈 화면(1_1_main)의 지도 중심은 사용자의 현재 위치로 설정합니다. 
    - ex. 사용자는 서울역에 있지만 새싹 찾기를 신촌으로 설정했더라도, 찾기 중단을 했다면 서울역으로 지도의 중심을 설정합니다. 

  

**뒤로 가기 버튼**

- 사용자(본인)이 매칭 대기중 상태를 유지한 채로 앱의 다른 기능을 사용할 수 있습니다. 

- 클릭 시 홈 화면(1_1_main)으로 전환됩니다. 

- 홈 화면에서 사용자가 새싹 찾기를 위해 설정했던 위치는 유지됩니다. 

  - ex. 사용자는 서울역에 있지만 새싹 찾기를 신촌으로 설정한 경우, 신촌으로 위치를 유지합니다.

  

**개발 고려 사항**

**새싹 찾기 화면 진입 시** 

- `(POST, /queue/onqueue)` 로 본인이 홈 화면의 지도에서 설정했던 위치를 보내고, 응답값을 통해 다른 사용자들이 입력했던 취미들을 목록으로 보여줍니다.
- ![:face_with_monocle:](https://pf-emoji-service--cdn.us-east-1.prod.public.atl-paas.net/standard/a51a7674-8d5d-4495-a2d2-a67c090f5c3b/64x64/1f9d0.png) **Point**
  - 홈 화면과 동일한 API를 호출하고 있습니다. 홈 화면에서 취미 입력 화면으로 화면이 전환될 때 값을 전달받지 않고, 한 번 더 통신을 하는 이유는 무엇일까요? 
  - *(참고) API 명세서의 포인트도 함께 참고하세요!*



**찾기 중단 버튼 클릭 시** 

- `(DELETE, /queue)` 를 호출합니다. 

- 성공(200)

  - 사용자 현재 상태는 일반 상태로 변경됩니다. 
  - 타이머 등 새싹 찾기 화면에서 진행중인 로직을 정리합니다. 
  - 홈 화면으로 전환합니다. 

- 201: 찾기 중단을 하려고 했으나 이미 다른 사용자와 매칭이 된 상태입니다.  

  - “앗! 누군가가 나의 취미 함께 하기를 수락하였어요!” 토스트 메시지를 1초간 띄웁니다.
  - `(GET, /queue/myQueueState)` 를 호출합니다. 이후 로직은 상기에 작성된 [핵심 요소] 를 참고하세요. 

  

**Timer 처리**

- 상대방과 매칭되어 채팅방으로 이동하거나, [찾기 중단]으로 새싹 찾기 화면이 사라지는 등 다양한 화면 전환과 로직이 있을 수 있습니다.
- 이 때, `(POST, /queue/onqueue)` 와 `(GET, /queue/myQueueState)` 호출을 위해 사용하던 타이머 정지 또는 Notification Observer 제거 등 보이지 않는 로직도 신경을 써주셔야 합니다.

---







### 새싹 찾기 빈 화면



### 주변 새싹 화면 받은 요청 화면

```
(POST, /queue/onqueue)
```

- [x] **주변 새싹 탭 목록** - fromQueueDB
- [x] **받은 요청 탭 목록** - fromQueueDBRequested
- [ ] 배경이미지 - fromQueueDB, fromQueueDBRequested 배열 내 `background`
- [ ] 새싹이미지 - fromQueueDB, fromQueueDBRequested 배열 내 `sesac`
- [ ] 닉네임 - fromQueueDB, fromQueueDBRequested 배열 내 `nick`
- [ ] 

### 요청/수락 팝업 화면



- **요청하기 팝업**
  - [취소] 버튼을 누르면 팝업 화면이 사라집니다.
  - [확인] 버튼을 누르면 상대방에게 취미 함께 하기 요청이 완료됩니다.
  - 요청이 완료된다면 팝업 화면이 사라진 이후에 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다. 
  - 요청을 위해 `(POST, /queue/hobbyrequest)` 를 호출합니다. 
- **수락하기 팝업**
  - [취소] 버튼을 누르면 팝업 화면이 사라집니다. 
  - [확인] 버튼을 누르면 상대방에게 취미 함께 하기 요청이 완료됩니다. 
  - 수락이 완료된다면 팝업 화면이 사라진 이후에 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다.  채팅 화면으로 전환합니다. [2022.02.13 수정사항] 
  - 수락을 위해 `(POST, /queue/hobbyaccept)` 를 호출합니다. 



- **요청하기 팝업에서 [확인] 버튼 클릭 시**

- [ ] 상대방에게 취미 함께 하기를 요청합니다. 이를 `(POST, /queue/hobbyrequest)` 를 통해 요청하고, 서버의 응답에 따라 로직을 다르게 처리합니다.
- [ ] **요청 바디** 
  - [ ] otheruid취미 함께 하기를 요청할 상대방의 uid 입니다. 
- [ ] **응답 코드**
  - [ ] 성공(200): 취미 함께 하기 요청이 성공적으로 이루어졌습니다. 
    - [ ] 팝업 화면이 사라진 뒤 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다.
  - [ ] 201: 사용자(본인)도 상대방에게 요청하기를 보냈지만, 상대방도 사용자(본인)에게 요청하기를 이미 보내둔 상태입니다. 
    - [ ] `(POST, /queue/hobbyaccept)` 를 호출합니다.
    - [ ] `(POST, /queue/hobbyaccept)` 에 대해 응답 코드 200을 받았다면, 사용자(본인)의 현재 상태를 매칭된 상태로 변경하고 팝업 화면을 dismiss합니다.
    - [ ] 팝업 화면이 사라진 뒤 새싹 찾기 화면 하단에서 “상대방도 취미 함께 하기를 요청했습니다. 채팅방으로 이동합니다” 토스트 메시지를 1초 띄운 뒤, 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
  - [ ] 202: 상대방이 취미 함께 하기를 중단, 즉 찾기중단을 한 상태입니다. “상대방이 취미 함께 하기를 그만두었습니다“ 토스트 메시지만 띄웁니다.



- **수락하기 버튼 클릭 시**
- [ ] 원하는 상대방과 취미를 함께 하기 위해 수락합니다. 이를 `(POST, /queue/hobbyaccept)` 를 통해 요청하고, 서버의 응답에 따라 로직을 다르게 처리합니다.
- [ ] **요청 바디** 
  - [ ] otheruid
    - [ ] 취미를 함께할 상대방의 uid 입니다. 
- [ ] **응답 코드**
- [ ] 성공(200): 취미 함께 하기 매칭이 성공적으로 이루어졌습니다. 사용자(본인)의 현재 상태를 매칭된 상태로 변경하고 팝업 화면을 dismiss합니다. 팝업 화면이 사라진 뒤 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
- [ ] 201: 상대방의 요청을 사용자(본인)이 수락했지만, 상대방이 이미 다른 사람과 취미 함께 하기를 하고 있는 상태입니다. 
  - [ ] “상대방이 이미 다른 사람과 취미를 함께 하는 중입니다” 토스트 메시지만 띄웁니다. 
- [ ] 202: 상대방이 취미 함께 하기를 중단, 즉 찾기중단을 한 상태입니다. 
  - [ ] “상대방이 취미 함께 하기를 그만두었습니다“ 토스트 메시지만 띄웁니다. 
- [ ] 203: 상대방의 요청을 사용자(본인)가 수락하려고 했으나, 이미 다른 상대방과 매칭이 된 상태입니다. 사용자(본인)가 취미 함께 하기 요청을 보냈었던 상대방이 사용자(본인)을 수락한 경우에 해당합니다. 
  - [ ] “앗! 누군가가 나의 취미 함께 하기를 수락하였어요!” 토스트 메시지를 띄웁니다.
  - [ ] `(GET, /queue/myQueueState)` 를 호출합니다.

- `(GET, /queue/myQueueState)`
- [ ] **출력 결과**
  - [ ] 매칭 대기중 상태에서는 reviewed, matched, dodged 3개의 응답값이 출력되지만, 취미 함께 하기로 매칭된 경우에 matchedNick과 matchedUid가 응답값에 추가됩니다. `1{ 2  "reviewed" : 0, 3  "matched" : 1, 4  "dodged" : 0, 5  "matchedNick": "고래밥", 6  "matchedUid": "x4r4tjQZ8Pf9mFYUgkfmC4REcvu2" 7} `
- [ ] **응답 코드**
  - [ ] 성공(200): 사용자(본인)의 현재 상태가 성공적으로 조회되었으며, matched 값이 1인 경우를 대응합니다. 
    - [ ] matched 값이 1이라면, 사용자(본인)의 현재 상태를 매칭된 상태로 변경합니다.
    - [ ] 1초 동안 토스트 메시지를 띄웁니다 
      - [ ] 요청하기 버튼을 클릭한 경우: “상대방도 취미 함께 하기 요청을 했습니다. 채팅방으로 이동합니다“
      - [ ] 수락하기 버튼을 클릭한 경우: “채팅방으로 이동합니다” 
    - [ ] 토스트 메시지 띄운 뒤, 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
  - [ ] 201: 취미를 함께 하기 위해 새싹 친구를 찾는 시간이 오래 되어 찾기중단으로 처리된 경우입니다.
    - [ ] “오랜 시간 동안 매칭 되지 않아 새싹 친구 찾기를 그만둡니다”는 토스트 메시지를 1초간 띄웁니다. 
    - [ ] 사용자(본인)의 현재 상태를 일반 상태로 변경한 뒤, 홈 화면으로 화면을 전환합니다.

