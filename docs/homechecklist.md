

## ✐ checklist

**홈화면**

- [ ] ui

  - [x] 다른 사용자들의 새싹핀 이미지: (post, queue/onqueue)의 sesac에 해당
  - [x] 중앙 고정 핀: 새싹 찾기를 할 때 사용할 기준 위치
  - [x] 성별 필터 버튼:  (post, queue/onqueue)의 gender에 해당
  - [x] gps 버튼: 현재 위치, 위치 권한 없다면 alert 띄우기
  - [x] 플로팅버튼: 일반 상태 / 대기중 상태 / 매칭된 상태
  - [ ] 주변 새싹 탐색 기능:
    - [ ] Gps 버튼 클릭 시
    - [ ] Corelocation 메서드를 통해 위치가 업데이트 될 때
    - [ ] 위치 권한이 변경될 때
    - [ ] 성별 필터 버튼을 클릭할 때
    - [ ] 사용자가 맵을 움직일 때(이동, 확대, 축소 등)
    - [ ] 다른 화면에서 홈 화면으로 전환되었을 때
- [ ] 홈 화면 보일 때 마다
  - [ ] 사용자 현재 상태를 확인하고, 플로팅 버튼을 설정
  - [x] 사용자 현재 위치를 확인하고, 지도의 중심을 설정
    - [x] 위치 권한이 없으면 영등포 캠퍼스를 기준으로 설정

  - [ ] (POST, /queue/onqueue)로 사용자의 위치를 보내고, 응답값을 통해 다른 사용자들(매칭 대기중 상태)를 지도에 새싹핀으로 표시

- [ ] 사용자 현재 상태 확인
  - [ ] UserDefaults에 저장된 사용자의 현재 상태를 통해 UI를 업데이트
  - [ ] 🧐 **Point**  
    - [ ] 어떤 로직에서 사용자의 현재 상태가 변경될까요? Ex 새싹 찾기 버튼 클릭, 찾기 중단 클릭, 매칭 후 약속 취소

- [ ] FCM 토큰 갱신
  - [ ] 클라이언트에서 가지고 있는 FCM 토큰과 서버에서 가지고 있는 토근 비교, 다른 경우 (PUT, /user/update_fcm_token)로 업데이트
  - [ ] 🧐 **Point**  
    - [ ] 새 기기에서 앱 복원, 사용자가 앱 삭제/재설치, 사용자가 앱 데이터 소거를 제외하고 등록 토큰이 변경되지 않는다. 그럼 FCM토큰 갱신이 언제, 왜 필요할까요? - 홈화면 진입할 때

- [ ] 성별 필터 버튼
  - [ ] gender: 여자0 남자1 전체는 전체

- [ ] 지도뷰
  - [x] Default: 중앙 핀 기준 반지름이 700m인 원이 보이도록 축적 설정, 세로는 자유롭게
    - [x] 지도 축소/확대 비율: 반지름 3km 축소, 반지름 50m 확대

  - [x] 지도 Interaction(option)
    - [x] 사용자가 제스처를 통해 이리저리 이동하면 서버 요청이 어려워짐
    - [x] 사용자가 제스처를 통해 맵을 움직이고 난 시점부터 0.8초 동안은 지도의 인터랙션을 금지. 움직인 직후 0.8초가 지나면 다시 지도를 이동하거나 확대, 축소 가능

- [x] 위치 권한 확인
  - [x] 거부상태
    - [x] 중심 영등포캠퍼스: 위도(37.517819364682694), 경도(126.88647317074734)
    - [ ] gps 버튼 클릭, 일반 상태에서 플로팅 버튼 클릭 시 "위치 서비스 사용 불가" 얼럿을 띄우고 아이폰 전체 설정으로 이동

- [ ] 플로팅 버튼 클릭 시
  - [ ] 일반 상태
    - [ ] 위치 권한 허용된 상태 + 성별 설정 상태 > 취미 입력 화면(1-2)으로 전환
      - [ ] 성별 -1인 경우 "새싹 찾기 기능을 이용하기 위해서는 성별이 필요해요!" 토스트 띄우고 정보 관리 화면으로 전환

  - [ ] 매칭 대기중 상태
    - [ ] 새싹 찾기 화면(1-3)으로 전환

  - [ ] 매칭된 상태
    - [ ] 채팅 화면으로 전환

- [x] **(POST, /queue/onqueue) 에 대한 요청 바디 정보** 
  - [x] region: (위도+90 후 소수점 제거)[:5] + (경도+180 후 소수점 제거)[:5] 총 10자리 전송
  - [x] 위도
  - [x] 경도

---

**취미 입력 화면**

- 서치바
- [ ] 취미를 한 개 또는 여러 개 입력할 수 있고, 키보드 리턴키를 클릭할 경우 [내가 하고 싶은] 섹션에 추가됩니다. 
  - [x] 취미 조건 최소 1자리 최대 8자리 
    - [x] 조건에 맞지 않는 텍스트를 입력할 경우 실시간으로 “최소 한 자 이상, 최대 8글자까지 작성 가능합니다” 토스트 메시지
  - [x] [내가 하고 싶은] 섹션에 이미 8개의 취미가 등록되어 있다면, “취미를 더 이상 추가할 수 없습니다” 토스트 메시지
- [x] 여러 단어를 입력할 경우 띄워쓰기 기준으로 취미가 추가
  - [x] ex. ‘클라이밍요가 번지점프 스쿠버다이빙' 입력하면 3개의 취미로 등록

- 지금 주변에는

- [ ] 서비스에서 추천하는 취미와 다른 사용자들의 취미
- [ ] 서비스에서 추천하는 취미는 분홍색 계열의 컬러로 구성
  - `(POST, /queue/onqueue)`에서 fromRecommend에 해당 
- [ ] 다른 사용자들의 취미는 회색 계열의 컬러로 구성
  - `(POST, /queue/onqueue)`에서 fromQueueDB, fromQueueDBRequested 배열의 hf 에 해당
- [ ] 원하는 취미를 선택하면 [내가 하고 싶은] 섹션 항목에 추가
  - [x] [내가 하고 싶은] 섹션에 이미 8개의 취미가 등록되어 있다면, “취미를 더 이상 추가할 수 없습니다” 토스트 메시지
- [x] 글자 사이즈에 맞춰 셀 너비가 달라지게 설정.

- 내가 하고 싶은

- [x] 본인이 하고 싶은 취미를 기입하는 곳으로, 최대 8개의 취미를 등록할 수 있다. 
  - [ ] 내가 하고 싶은 섹션에 이미 추가된 취미를 또 추가하려고 할 경우, “이미 등록된 취미입니다”를 토스트 메시지
- [ ] 서치바 입력을 통해 취미를 추가할 수도 있고, [지금 주변에는] 에 있는 취미를 선택해 추가할 수도 있다. 
- [ ] [내가 하고 싶은] 섹션에 추가되어 있는 셀을 클릭할 경우 셀은 제거. 즉, 하고 싶은 취미에서 제거. 
- [x] 글자 사이즈에 맞춰 셀 너비가 달라짐. 

- 새싹 찾기 버튼

- [ ] 취미를 함께할 친구를 찾는다는 요청을 서버에 보냄. 
  - [ ] `(POST, /queue)` 를 호출하고 성공 응답이 오면 새싹 찾기 화면(1_3_near_user & 1_4_accept)으로 전환합니다.
- [x] 키보드가 올라오면 버튼도 함께 올라오고 버튼의 UI가 변형. (아래 영상 참고)

---

- 취미 입력 화면 보일 때마다
- [x] `(POST, /queue/onqueue)` 로 본인이 홈 화면의 지도에서 설정했던 위치를 보내고, 응답값을 통해 다른 사용자들이 입력했던 취미들을 목록으로 보여줍니다.
- [x]  **Point**
  - [x] 홈 화면과 동일한 API를 호출하고 있습니다. 홈 화면에서 취미 입력 화면으로 화면이 전환될 때 값을 전달받지 않고, 한 번 더 통신을 하는 이유는 무엇일까요? 
- 새싹 찾기 버튼 클릭 시
- [ ] 본인이 새싹 찾기를 할 예정이라는 것을 API`(POST, /queue)`를 통해 요청하고, 서버의 응답에 따라 로직을 다르게 처리합니다. 
- [ ] (POST, /queue)` 를 호출합니다.
  - **요청 바디**
    - [ ] type : 항상 2 로 요청합니다. 
    - [ ] hf
      - [ ] [내가 하고 싶은] 섹션에 등록된 취미를 배열로 보냅니다.
      - [ ] 취미를 하나도 등록 하지 않은 경우에는, “Anything” 가 추가된 배열을 내부적으로 서버에 보냅니다. (사용자 입장에서는 “Anything”이 추가되는 지 알 수 없음)
    - [x] region, lat, long
  - **응답 코드**
    - [ ] 성공(200): 새싹 찾기 화면(1_3_near_user & 1_4_accept)으로 전환
    - [ ] 201: “신고가 누적되어 이용하실 수 없습니다” 토스트 메시지
    - [ ] 203: “약속 취소 패널티로, 1분동안 이용하실 수 없습니다” 토스트 메시지를 띄우고 취미 입력 화면을 그대로 유지
    - [ ] 204: “약속 취소 패널티로, 2분동안 이용하실 수 없습니다” 토스트 메시지를 띄우고 취미 입력 화면을 그대로 유지
    - [ ] 205: “연속으로 약속을 취소하셔서 3분동안 이용하실 수 없습니다” 토스트 메시지를 띄우고 취미 입력 화면을 그대로 유지
    - [ ] 206: “새싹 찾기 기능을 이용하기 위해서는 성별이 필요해요!”라는 토스트 메시지를 띄우고, 정보 관리 화면(4_1_my_info)으로 전환
- 키보드 제어
- [x] 서치바를 클릭할 경우 키보드가 올리기
- [x] 취미 입력 화면을 수직 스크롤 할 경우 키보드가 내리기



---

- **요청하기 팝업**
  - [취소] 버튼을 누르면 팝업 화면이 사라집니다.
  -  [확인] 버튼을 누르면 상대방에게 취미 함께 하기 요청이 완료됩니다.
  - 요청이 완료된다면 팝업 화면이 사라진 이후에 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다. 
  - 요청을 위해 `(POST, /queue/hobbyrequest)` 를 호출합니다. 

- **수락하기 팝업**
  - [취소] 버튼을 누르면 팝업 화면이 사라집니다. 
  - [확인] 버튼을 누르면 상대방에게 취미 함께 하기 요청이 완료됩니다. 
  - 수락이 완료된다면 팝업 화면이 사라진 이후에 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다.  채팅 화면으로 전환합니다. [2022.02.13 수정사항] 
  - 수락을 위해 `(POST, /queue/hobbyaccept)` 를 호출합니다. 



- **요청하기 팝업에서 [확인] 버튼 클릭 시**

- [ ] 상대방에게 취미 함께 하기를 요청합니다. 이를 `(POST, /queue/hobbyrequest)` 를 통해 요청하고, 서버의 응답에 따라 로직을 다르게 처리합니다.
- [ ] **요청 바디** 
  - [ ] otheruid취미 함께 하기를 요청할 상대방의 uid 입니다. 
- [ ] **응답 코드**
  - [ ] 성공(200): 취미 함께 하기 요청이 성공적으로 이루어졌습니다. 
    - [ ] 팝업 화면이 사라진 뒤 새싹 찾기 화면 하단에서 “취미 함께 하기 요청을 보냈습니다” 토스트 메시지를 띄웁니다.
  - [ ] 201: 사용자(본인)도 상대방에게 요청하기를 보냈지만, 상대방도 사용자(본인)에게 요청하기를 이미 보내둔 상태입니다. 
    - [ ] `(POST, /queue/hobbyaccept)` 를 호출합니다.
    - [ ] `(POST, /queue/hobbyaccept)` 에 대해 응답 코드 200을 받았다면, 사용자(본인)의 현재 상태를 매칭된 상태로 변경하고 팝업 화면을 dismiss합니다.
    - [ ]  팝업 화면이 사라진 뒤 새싹 찾기 화면 하단에서 “상대방도 취미 함께 하기를 요청했습니다. 채팅방으로 이동합니다” 토스트 메시지를 1초 띄운 뒤, 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
  - [ ] 202: 상대방이 취미 함께 하기를 중단, 즉 찾기중단을 한 상태입니다. “상대방이 취미 함께 하기를 그만두었습니다“ 토스트 메시지만 띄웁니다.



- **수락하기 버튼 클릭 시**
- [ ] 원하는 상대방과 취미를 함께 하기 위해 수락합니다. 이를 `(POST, /queue/hobbyaccept)` 를 통해 요청하고, 서버의 응답에 따라 로직을 다르게 처리합니다.
- [ ] **요청 바디** 
  - [ ] otheruid
    - [ ] 취미를 함께할 상대방의 uid 입니다. 
- [ ] **응답 코드**
- [ ] 성공(200): 취미 함께 하기 매칭이 성공적으로 이루어졌습니다. 사용자(본인)의 현재 상태를 매칭된 상태로 변경하고 팝업 화면을 dismiss합니다. 팝업 화면이 사라진 뒤 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
- [ ] 201: 상대방의 요청을 사용자(본인)이 수락했지만, 상대방이 이미 다른 사람과 취미 함께 하기를 하고 있는 상태입니다. 
  - [ ] “상대방이 이미 다른 사람과 취미를 함께 하는 중입니다” 토스트 메시지만 띄웁니다. 
- [ ] 202: 상대방이 취미 함께 하기를 중단, 즉 찾기중단을 한 상태입니다. 
  - [ ] “상대방이 취미 함께 하기를 그만두었습니다“ 토스트 메시지만 띄웁니다. 
- [ ] 203: 상대방의 요청을 사용자(본인)가 수락하려고 했으나, 이미 다른 상대방과 매칭이 된 상태입니다. 사용자(본인)가 취미 함께 하기 요청을 보냈었던 상대방이 사용자(본인)을 수락한 경우에 해당합니다. 
  - [ ] “앗! 누군가가 나의 취미 함께 하기를 수락하였어요!” 토스트 메시지를 띄웁니다.
  - [ ]  `(GET, /queue/myQueueState)` 를 호출합니다.

- `(GET, /queue/myQueueState)`
- [ ] **출력 결과**매칭 대기중 상태에서는 reviewed, matched, dodged 3개의 응답값이 출력되지만, 취미 함께 하기로 매칭된 경우에 matchedNick과 matchedUid가 응답값에 추가됩니다. `1{ 2  "reviewed" : 0, 3  "matched" : 1, 4  "dodged" : 0, 5  "matchedNick": "고래밥", 6  "matchedUid": "x4r4tjQZ8Pf9mFYUgkfmC4REcvu2" 7} `
- [ ] **응답 코드**
  - [ ]  성공(200): 사용자(본인)의 현재 상태가 성공적으로 조회되었으며, matched 값이 1인 경우를 대응합니다. 
    - [ ] matched 값이 1이라면, 사용자(본인)의 현재 상태를 매칭된 상태로 변경합니다.
    - [ ]  1초 동안 토스트 메시지를 띄웁니다 
      - [ ] 요청하기 버튼을 클릭한 경우: “상대방도 취미 함께 하기 요청을 했습니다. 채팅방으로 이동합니다“
      - [ ] 수락하기 버튼을 클릭한 경우: “채팅방으로 이동합니다” 
    - [ ] 토스트 메시지 띄운 뒤, 채팅 화면(1_5_chatting)으로 화면을 전환합니다. 
  - [ ] 201: 취미를 함께 하기 위해 새싹 친구를 찾는 시간이 오래 되어 찾기중단으로 처리된 경우입니다.
    - [ ]  “오랜 시간 동안 매칭 되지 않아 새싹 친구 찾기를 그만둡니다”는 토스트 메시지를 1초간 띄웁니다. 
    - [ ] 사용자(본인)의 현재 상태를 일반 상태로 변경한 뒤, 홈 화면으로 화면을 전환합니다.








|      |      |
| :--- | ---- |
|      |      |
|      |      |

 
